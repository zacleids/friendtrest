<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">

    <!--jquery compatible with bootstrap-->
    <script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

    <!--bootstrap js-->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/latest/js/bootstrap.min.js"></script>

    <script type="text/javascript" src="js/appearance.js"></script>
    <script type="text/javascript" src="js/array.js"></script>

    <!--bootstrap css-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/latest/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/latest/css/bootstrap-theme.min.css">

    <link rel="stylesheet" type="text/css" href="css/bootstrap-social.css">
    <link rel="stylesheet" type="text/css" href="css/global-styles.css">
    <link rel="stylesheet" type="text/css" href="css/index.css">

    <link rel="stylesheet" type="text/css" href="css/rating.css">

    <title>Rating Prototype</title>
</head>

<body>
    <div class="row" id="row1">
        <div class="col-md-3" id="item1"></div>
    </div>

    <div class="row" id="row2">
        <div class="col-md-3" id="item2"></div>
    </div>

    <div id="result"></div>
<script>
    var shown = false;
    var review = {uuid:"", rating:0, review_text:"", item_id:"", user_id:""};
    var review_uuid = "8227c1f7-e52c-4dec-ab1d-e9d2bd9c44c6";
    var rating;
    var review_text;

    $(document).ready(function() {
        $("#item1").html(makePopup(1));
        $("#item2").html(makePopup(2));

        $(".popup").on('click', '.controls', function() {
            if (shown) {
                $(".rate_rev").css("display", "none");
                $(".popup").css("width", "25px");
                $(".close").css("display", "none");
                $(".close_place").css("display", "block");
                $(".toggle").css("margin-top", "0px");

                submitRateRev();

                shown = false;
            } else {
                $(".rate_rev").css("display", "block");
                $(".popup").css("width", "245px");
                $(".close").css("display", "block");
                $(".close_place").css("display", "none");
                $(".toggle").css("margin-top", "25px");

                shown = true;
            }
        });

        $.get("/rest/reviewTest", {uuid: review_uuid}, function(review_new) {
            review.rating = review_new.rating;
            review.review_text = review_new.review_text;
            review.uuid = review_new.uuid;
            review.item_id = review_new.item_id;
            review.user_id = review_new.user_id;
            $(".rating").val(review.rating);
            $(".review").val(review.review_text);
        }).fail(function() {
            alert("Retrieval failed");
        });

    });

    function submitRateRev() {
        rating = $(".rating").val();
        review_text = $(".review").val();

        $.get("/rest/reviewTestSubmit", {
            uuid: review_uuid,
            rating: rating,
            review_text: review_text,
            item_id: review.item_id,
            user_id: review.user_id
        }, function() {
            alert("submitted");
        }).fail(function() {
            alert("Submission failed");
        });
    }
</script>

</body>

</html>
