<!DOCTYPE html>
<html lang="en">
<head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">

    <script type="text/javascript" src="js/writeHead.js"></script>
    <link rel="stylesheet" type="text/css" href="css/reviews-styles.css">
</head>
<body>
<!-- javascript file will write the nav bar given the name of the page -->
<script type="text/javascript" src="js/writeNavBar.js"></script>
<script>
    generateNavBar("index");
</script>
<br><br><br><br><br><br>
<table>
    <tr>
        <td>Name: </td>
        <td> <input id="name" type="text" placeholder="Name" autofocus /> </td>
    </tr>
    <tr>
        <td>Year: </td>
        <td> <input id="year" type="number" placeholder="ex. 2016" min="1920" max="2016"> </td>
    </tr>
    <tr>
        <td><button id="submit" onclick="redirect()">Submit</button></td>
    </tr>
</table>
<div id="items">

</div>


<script>
    function getItem() {
        $("#items").html("");
        var name = getAddressPart("name", location.href);
        var year = getAddressPart("year", location.href);
        if(name === null){
            return;
        }
        if(year === null){
            year = "";
        }
        $("#name").val(name);
        $("#year").val(year);
        $.get("/rest/search", { name: name, year: year, tagString: ""}, function(items) {
            console.log(items.length);
            if(items.length === 0){
                displayNoItems();
            }
            for(var i = 0; i < items.length; i++){
                displayItem(items[i]);
            }
        });
    }

    function displayItem(item){
        var text = "<div id='movie'>" +
                "<img src='" + item.url + "' >" +
                "<b>" +
                item.name +
                "</b>  Released: " +
                item.releaseDate  +
                "</div><hr>";
        $("#items").html($("#items").html() + text);
    }

    function displayNoItems(){
        var text = "<h3>No Items to display</h3>";
        $("#items").html($("#items").html() + text);
    }

    function redirect(){
        var name = $("#name").val();
        var year = $("#year").val();
        var url = location.href;
        var site = url;
        if(url.indexOf(".com") === -1){
            site = url.split("/")[0] + "/search.html?name=" + name.replace(/ /g, '+') + "&year=" + year;
        } else{
            site = url.split(".com")[0] + ".com/search.html?name=" + name.replace(/ /g, '+') + "&year=" + year;
        }

        console.log(site);
        window.location.replace(site);
    }

    $( document ).ready(function() {
        getItem();

    });
</script>

</body>
</html>